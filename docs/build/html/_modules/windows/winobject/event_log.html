<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>windows.winobject.event_log &#8212; PythonForWindows 1.0.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css?v=def86cc0" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/mbasic.css?v=957880af" />
    
    <script src="../../../_static/documentation_options.js?v=baaebd52"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">PythonForWindows 1.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">windows.winobject.event_log</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for windows.winobject.event_log</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">xml.dom.minidom</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="kn">import</span> <span class="nn">windows</span>
<span class="kn">import</span> <span class="nn">windows.generated_def</span> <span class="k">as</span> <span class="nn">gdef</span>
<span class="kn">from</span> <span class="nn">windows</span> <span class="kn">import</span> <span class="n">winproxy</span>
<span class="kn">from</span> <span class="nn">windows.pycompat</span> <span class="kn">import</span> <span class="n">int_types</span><span class="p">,</span> <span class="n">basestring</span>


<span class="c1"># Helpers</span>


<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">ClosingEvtHandle</span><span class="p">(</span><span class="n">handle</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">handle</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">winproxy</span><span class="o">.</span><span class="n">EvtClose</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>


<span class="c1"># low-level api helpers</span>
<span class="k">def</span> <span class="nf">queryinfo</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">evt</span> <span class="o">=</span> <span class="n">ImprovedEVT_VARIANT</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
    <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetLogInfo</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">evt</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">evt</span>

<span class="k">def</span> <span class="nf">arrayproperty</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">evt</span> <span class="o">=</span> <span class="n">ImprovedEVT_VARIANT</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
    <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetObjectArrayProperty</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">evt</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">evt</span>

<span class="k">def</span> <span class="nf">generate_query_function</span><span class="p">(</span><span class="n">query_function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">generated_query_function</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x10000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">evt</span> <span class="o">=</span> <span class="n">ImprovedEVT_VARIANT</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="n">query_function</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">evt</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">evt</span>
    <span class="k">return</span> <span class="n">generated_query_function</span>

<span class="n">chaninfo</span> <span class="o">=</span> <span class="n">generate_query_function</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetChannelConfigProperty</span><span class="p">)</span>
<span class="n">eventinfo</span> <span class="o">=</span> <span class="n">generate_query_function</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetEventMetadataProperty</span><span class="p">)</span>
<span class="n">publishinfo</span> <span class="o">=</span> <span class="n">generate_query_function</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetPublisherMetadataProperty</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EvtHandle</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_HANDLE</span><span class="p">):</span>
    <span class="c1"># Class attribute function</span>
    <span class="c1"># Will pass (self) as first parameter (binding)</span>
    <span class="c1"># No need to pass any param to close ourself :)</span>
    <span class="n">_close_function</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtClose</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_function</span><span class="p">()</span>

<span class="c1"># Class high-level API</span>
<div class="viewcode-block" id="EvtQuery">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtQuery">[docs]</a>
<span class="k">class</span> <span class="nc">EvtQuery</span><span class="p">(</span><span class="n">EvtHandle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent an Event-log query&quot;&quot;&quot;</span>
    <span class="n">DEFAULT_TIMEOUT</span> <span class="o">=</span> <span class="mh">0x1000</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EvtQuery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span> <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_TIMEOUT</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the next :class:`EvtEvent` matching the query&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">EvtEvent</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
            <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtNext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">==</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_NO_MORE_ITEMS</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">StopIteration</span>
            <span class="k">raise</span>
        <span class="k">assert</span> <span class="n">ret</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">event</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

<div class="viewcode-block" id="EvtQuery.seek">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtQuery.seek">[docs]</a>
    <span class="k">def</span> <span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">seek_flags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Seek to ``position``.</span>
<span class="sd">        ``seek_flags`` can be one of:</span>

<span class="sd">            * ``None``</span>
<span class="sd">            * ``EvtSeekRelativeToFirst``</span>
<span class="sd">            * ``EvtSeekRelativeToLast``</span>
<span class="sd">            * ``EvtSeekRelativeToBookmark``</span>

<span class="sd">        If ``seek_flags`` is None:</span>

<span class="sd">            * ``position &gt;= 0`` will use ``EvtSeekRelativeToFirst``</span>
<span class="sd">            * ``position &lt; 0`` will use ``EvtSeekRelativeToLast`` and with ``position+1``</span>
<span class="sd">                * This allow retrieve the ``position`` lasts events</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">seek_flags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">position</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">seek_flags</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtSeekRelativeToFirst</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># -1 + EvtSeekRelativeToLast will give us the last 2 events</span>
                <span class="c1"># So passing (-1, None) will give us the last event only</span>
                <span class="c1"># If user do not want this calcul it can directly pass seek_flags</span>
                <span class="n">seek_flags</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtSeekRelativeToLast</span>
                <span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtSeek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">seek_flags</span><span class="p">)</span></div>


    <span class="nb">next</span> <span class="o">=</span> <span class="fm">__next__</span> <span class="c1"># Yep.. real name is &#39;next&#39; in Py2 :D</span>

<div class="viewcode-block" id="EvtQuery.all">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtQuery.all">[docs]</a>
    <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># SqlAlchemy like :)</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list with all the query results</span>

<span class="sd">        :rtype: [:class:`EvtEvent`] -- A list of Event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="EvtQuery.first">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtQuery.first">[docs]</a>
    <span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># SqlAlchemy like :) -&gt; allow testing in interactive console</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the first query result</span>

<span class="sd">        :rtype: :class:`EvtEvent` -- An Event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>
</div>





<div class="viewcode-block" id="EvtEvent">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtEvent">[docs]</a>
<span class="k">class</span> <span class="nc">EvtEvent</span><span class="p">(</span><span class="n">EvtHandle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An Event log&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EvtEvent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">rtype</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x10000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">rsize</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="n">elementnb</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtRender</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">rtype</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">rsize</span><span class="p">,</span> <span class="n">elementnb</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_INSUFFICIENT_BUFFER</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">rsize</span><span class="o">.</span><span class="n">value</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtRender</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">rtype</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">rsize</span><span class="p">,</span> <span class="n">elementnb</span><span class="p">)</span>
        <span class="c1"># Adapting return value type</span>
        <span class="k">if</span> <span class="n">rtype</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderEventValues</span><span class="p">:</span>
            <span class="c1"># import pdb;pdb.set_trace()</span>
            <span class="c1"># assert elementnb.value == 1</span>
            <span class="k">return</span> <span class="n">buffer</span><span class="p">[:</span><span class="n">rsize</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="c1"># print(&quot;Got &lt;{0}&gt; elt&quot;.format(elementnb.value))</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">((</span><span class="n">ImprovedEVT_VARIANT</span> <span class="o">*</span> <span class="n">elementnb</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">render_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-16&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">xml</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">xml</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="EvtEvent.value">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtEvent.value">[docs]</a>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve a value from the event.</span>
<span class="sd">        ``name`` is an XPath expressions that uniquely identify a node or attribute in the event.</span>
<span class="sd">        (see https://msdn.microsoft.com/en-us/library/windows/desktop/aa385352(v=vs.85).aspx)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">((</span><span class="n">name</span><span class="p">,),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextValues</span><span class="p">):</span>
        <span class="n">nbelt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">pwstr_values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">LPWSTR</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
        <span class="n">pwstr_rarray</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">LPWSTR</span> <span class="o">*</span> <span class="n">nbelt</span><span class="p">)(</span><span class="o">*</span><span class="n">pwstr_values</span><span class="p">)</span>
        <span class="c1"># https://msdn.microsoft.com/en-us/library/windows/desktop/aa385352(v=vs.85).aspx</span>
        <span class="c1"># An array of XPath expressions that uniquely identify a node or attribute in the event that you want to render.</span>
        <span class="c1"># Each value wil return 1 node :)</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtCreateRenderContext</span><span class="p">(</span><span class="n">nbelt</span><span class="p">,</span> <span class="n">pwstr_rarray</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextValues</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderEventValues</span><span class="p">)</span>
        <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtClose</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">system_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># POC: use this for all @property based on system data ?</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtCreateRenderContext</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextSystem</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderEventValues</span><span class="p">)</span>
        <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtClose</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>

<div class="viewcode-block" id="EvtEvent.event_values">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtEvent.event_values">[docs]</a>
    <span class="k">def</span> <span class="nf">event_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The values of the event in a list&quot;&quot;&quot;</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtCreateRenderContext</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextUser</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderEventValues</span><span class="p">)</span>
        <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtClose</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span></div>


    <span class="k">def</span> <span class="nf">get_raw_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextValues</span><span class="p">):</span>
        <span class="n">nbelt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">pwstr_values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">LPWSTR</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
        <span class="n">pwstr_rarray</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">LPWSTR</span> <span class="o">*</span> <span class="n">nbelt</span><span class="p">)(</span><span class="o">*</span><span class="n">pwstr_values</span><span class="p">)</span>
        <span class="c1"># https://msdn.microsoft.com/en-us/library/windows/desktop/aa385352(v=vs.85).aspx</span>
        <span class="c1"># An array of XPath expressions that uniquely identify a node or attribute in the event that you want to render.</span>
        <span class="c1"># Each value will return 1 node :)</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtCreateRenderContext</span><span class="p">(</span><span class="n">nbelt</span><span class="p">,</span> <span class="n">pwstr_rarray</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextValues</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderEventValues</span><span class="p">)</span>
        <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtClose</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


    <span class="c1"># Properties arround common Event/System values</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">provider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The provider of the event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_values</span><span class="p">()[</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtSystemProviderName</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">computer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The computer that generated the event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_values</span><span class="p">()[</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtSystemComputer</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The ID of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/EventID&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The version of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Version&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The level of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Level&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">opcode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The opcode of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Opcode&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_created</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The creation time of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/TimeCreated/@SystemTime&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The process ID of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Execution/@ProcessID&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The process ID of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Execution/@ThreadID&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">error_payload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/ProcessingErrorData/EventPayload&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span> <span class="k">if</span> <span class="n">raw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The User ID associated with the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_values</span><span class="p">()[</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtSystemUserID</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The medata for the current Event</span>

<span class="sd">        :type: :class:`EventMetadata`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">get_event_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">classic</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="c1"># id not found: try via the Provider in the event (classic channel)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">get_classic_event_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">provider</span><span class="p">)</span>

    <span class="c1"># Test</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># user/event specifique data</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A dict of EventData Name:Value for the current dict.</span>

<span class="sd">        :type: :class:`dict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># What about classic channels where there is no event_metadata ?</span>
        <span class="c1"># Return a dict with [0-1-2-3-4] as key ? raise ?</span>
        <span class="c1"># Juste use the render_xml ?</span>
        <span class="n">event_data_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">event_data</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">event_data_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_values</span><span class="p">())}</span>

    <span class="k">def</span> <span class="nf">xml_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">xmlevt</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">render_xml</span><span class="p">())</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">eventdata</span> <span class="o">=</span> <span class="n">xmlevt</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;EventData&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eventdata</span><span class="p">:</span>
            <span class="c1"># &lt;Data Name=&#39;FIELD_NAME&#39;&gt;FIELD_VALUE&lt;/Data&gt;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">datanode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xmlevt</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;Data&quot;</span><span class="p">)):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">datanode</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
                    <span class="c1"># Some Data in old EVTX have no name (Windows Powershell)</span>
                    <span class="c1"># Do the best we can by using the position of the event</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">datanode</span><span class="o">.</span><span class="n">hasChildNodes</span><span class="p">():</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">datanode</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">):</span>
                    <span class="kn">import</span> <span class="nn">pdb</span><span class="p">;</span><span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                <span class="n">res</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">userdata</span> <span class="o">=</span> <span class="n">xmlevt</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;UserData&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">userdata</span><span class="p">:</span>
            <span class="c1"># &lt;UserData&gt;</span>
            <span class="c1">#     &lt;EventXML xmlns=&quot;Event_NS&quot;&gt;</span>
            <span class="c1">#         &lt;FIELD_NAME&gt;FIELD_VALUE&lt;/FIELD_NAME&gt;</span>
            <span class="c1">#     &lt;/EventXML&gt;</span>
            <span class="c1"># &lt;/UserData&gt;</span>
            <span class="k">for</span> <span class="n">datanode</span> <span class="ow">in</span> <span class="n">userdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">childNodes</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">datanode</span><span class="o">.</span><span class="n">tagName</span>
                <span class="k">if</span> <span class="n">datanode</span><span class="o">.</span><span class="n">hasChildNodes</span><span class="p">():</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">datanode</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">assert</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span>
                <span class="n">res</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">res</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;``Event.time_created`` as a :class:``datetime``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">windows</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">datetime_from_filetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_created</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">creation_time</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">datetime_from_filetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_created</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> id=&quot;</span><span class="si">{self.id}</span><span class="s1">&quot; time=&quot;</span><span class="si">{creation_time}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">creation_time</span><span class="o">=</span><span class="n">creation_time</span><span class="p">)</span></div>



<span class="k">class</span> <span class="nc">ImprovedEVT_VARIANT</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT</span><span class="p">):</span>
    <span class="n">VALUE_MAPPER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeNull</span>       <span class="p">:</span> <span class="s1">&#39;NoneValue&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeString</span>     <span class="p">:</span> <span class="s1">&#39;StringVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeAnsiString</span> <span class="p">:</span> <span class="s1">&#39;AnsiStringVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSByte</span>      <span class="p">:</span> <span class="s1">&#39;SByteVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeByte</span>       <span class="p">:</span> <span class="s1">&#39;ByteVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeInt16</span>      <span class="p">:</span> <span class="s1">&#39;Int16Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt16</span>     <span class="p">:</span> <span class="s1">&#39;UInt16Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeInt32</span>      <span class="p">:</span> <span class="s1">&#39;Int32Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt32</span>     <span class="p">:</span> <span class="s1">&#39;UInt32Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeInt64</span>      <span class="p">:</span> <span class="s1">&#39;Int64Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt64</span>     <span class="p">:</span> <span class="s1">&#39;UInt64Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSingle</span>     <span class="p">:</span> <span class="s1">&#39;SingleVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeDouble</span>     <span class="p">:</span> <span class="s1">&#39;DoubleVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeBoolean</span>    <span class="p">:</span> <span class="s1">&#39;BooleanVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeBinary</span>     <span class="p">:</span> <span class="s1">&#39;BinaryVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeGuid</span>       <span class="p">:</span> <span class="s1">&#39;GuidVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSizeT</span>      <span class="p">:</span> <span class="s1">&#39;SizeTVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeFileTime</span>   <span class="p">:</span> <span class="s1">&#39;FileTimeVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSysTime</span>    <span class="p">:</span> <span class="s1">&#39;SysTimeVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSid</span>        <span class="p">:</span> <span class="s1">&#39;SidVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeHexInt32</span>   <span class="p">:</span> <span class="s1">&#39;UInt32Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeHexInt64</span>   <span class="p">:</span> <span class="s1">&#39;UInt64Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeEvtHandle</span>  <span class="p">:</span> <span class="s1">&#39;EvtHandleVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeEvtXml</span>     <span class="p">:</span> <span class="s1">&#39;XmlVal&#39;</span><span class="p">,</span>
        <span class="c1"># Array types: TODO: generic stuff</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeString</span> <span class="o">+</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT_TYPE_ARRAY</span> <span class="p">:</span> <span class="s2">&quot;StringArr&quot;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt16</span> <span class="o">+</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT_TYPE_ARRAY</span> <span class="p">:</span> <span class="s2">&quot;UInt16Arr&quot;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt32</span> <span class="o">+</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT_TYPE_ARRAY</span> <span class="p">:</span> <span class="s2">&quot;UInt32Arr&quot;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt64</span> <span class="o">+</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT_TYPE_ARRAY</span> <span class="p">:</span> <span class="s2">&quot;UInt64Arr&quot;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeHexInt64</span> <span class="o">+</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT_TYPE_ARRAY</span> <span class="p">:</span> <span class="s2">&quot;UInt64Arr&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">NoneValue</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raw_type</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ImprovedEVT_VARIANT</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">Type</span>
        <span class="k">return</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT_TYPE</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">raw_type</span><span class="p">,</span> <span class="n">raw_type</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Prototype !!</span>
        <span class="n">attrname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALUE_MAPPER</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">]</span>
        <span class="c1"># print(&quot;Resolve type &lt;{0}&gt; -&gt; {1}&quot;.format(self.Type, attrname))</span>
        <span class="n">v</span> <span class="o">=</span>  <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeBinary</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">Count</span><span class="p">]</span> <span class="c1"># No need for a raw UBYTE ptr</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeGuid</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Deref LP_GUID</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="o">&amp;</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT_TYPE_ARRAY</span><span class="p">:</span>
            <span class="c1"># TODO: handle all array type</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">Count</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">vtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">vtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Guess type</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">int_types</span><span class="p">):</span>
                <span class="n">vtype</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt64</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="n">vtype</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeString</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="c1"># not basestring and bytes -&gt; py3 bytes</span>
                <span class="n">vtype</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeBinary</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">BUFFER</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">BYTE</span><span class="p">)</span><span class="o">.</span><span class="n">from_buffer_copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;LATER&quot;</span><span class="p">)</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="c1"># import pdb;pdb.set_trace()</span>
        <span class="c1"># Yolo test :)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImprovedEVT_VARIANT</span><span class="p">,</span> <span class="n">ImprovedEVT_VARIANT</span><span class="p">)</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vtype</span><span class="p">)</span>
        <span class="c1"># super(ImprovedEVT_VARIANT, self).Type = vtype</span>
        <span class="n">attrname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALUE_MAPPER</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeBinary</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeString</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{0}</span><span class="s2"> of type=</span><span class="si">{1}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span>



<div class="viewcode-block" id="EvtChannel">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtChannel">[docs]</a>
<span class="k">class</span> <span class="nc">EvtChannel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An Event Log channel&quot;&quot;&quot;</span>
    <span class="n">DEFAULT_QUERY_FLAGS</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtQueryChannelPath</span> <span class="o">+</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtQueryForwardDirection</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_metadata_by_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classic_event_metadata_by_id</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># For classic only</span>

<div class="viewcode-block" id="EvtChannel.query">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtChannel.query">[docs]</a>
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query the event with the ``ids`` or perform a query with the raw query ``filter``</span>

<span class="sd">        Both parameters are mutually exclusive.</span>

<span class="sd">        .. note:: Here are some query examples</span>

<span class="sd">            List all events with a event data attribute named &#39;RuleName&#39;:</span>
<span class="sd">                ``Event/EventData/Data[@Name=&#39;RuleName&#39;]``</span>

<span class="sd">            List all events with a event data value of &#39;C:\\\\WINDOWS\\\\System32\\\\svchost.exe&#39;:</span>
<span class="sd">                ``Event/EventData[Data=&#39;C:\\WINDOWS\\System32\\svchost.exe&#39;]``</span>

<span class="sd">            List all events with an EventID of 2006:</span>
<span class="sd">                ``Event/System[EventID=2006]``</span>

<span class="sd">            List all event with a given EventID while searching for a specific field value (Sysmon for the test here)</span>
<span class="sd">                ``Event/System[EventID=3] and Event/EventData/Data[@Name=&#39;DestinationIp&#39;] and Event/EventData[Data=&#39;10.0.0.2&#39;]``</span>

<span class="sd">            List all events with a given provider of Microsoft-Windows-TaskScheduler:</span>
<span class="sd">                ``Event/System/Provider[@Name=&#39;Microsoft-Windows-TaskScheduler&#39;]``</span>

<span class="sd">        :rtype: :class:`EvtQuery`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ids</span> <span class="ow">and</span> <span class="nb">filter</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&lt;ids&gt; and &lt;filter&gt; are mutually exclusive&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">int_types</span><span class="p">):</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,)</span>
            <span class="n">ids_filter</span> <span class="o">=</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;EventID=</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">)</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="s2">&quot;Event/System[</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ids_filter</span><span class="p">)</span>
        <span class="n">query_handle</span> <span class="o">=</span> <span class="n">winproxy</span><span class="o">.</span><span class="n">EvtQuery</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_QUERY_FLAGS</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">EvtQuery</span><span class="p">(</span><span class="n">query_handle</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The list of all events in the channels, an alias for ``channel.query().all()``</span>

<span class="sd">        :type: [:class:`EvtEvent`] -- A list of :class:`EvtEvent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The configuration of the channel</span>

<span class="sd">        :type: :class:`ChannelConfig`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ChannelConfig</span><span class="o">.</span><span class="n">from_channel_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="EvtChannel.get_event_metadata">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtChannel.get_event_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">get_event_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the metadata for the event ID ``id``</span>

<span class="sd">        :rtype: :class:`EventMetadata`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_metadata_by_id</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">pub_metada</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_metadata_by_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">evtm</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">evtm</span> <span class="k">for</span> <span class="n">evtm</span> <span class="ow">in</span> <span class="n">pub_metada</span><span class="o">.</span><span class="n">events_metadata</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_metadata_by_id</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span></div>


    <span class="k">def</span> <span class="nf">get_classic_event_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">providername</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">providername</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classic_event_metadata_by_id</span><span class="p">:</span>
            <span class="c1"># print(&quot;CALCUL FOR PROVIDER: &lt;{0}&gt; !!!!!!!!!!!!!!&quot;.format(providername))</span>
            <span class="n">publisher</span> <span class="o">=</span> <span class="n">EvtPublisher</span><span class="p">(</span><span class="n">providername</span><span class="p">)</span>
            <span class="n">events_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">publisher</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">events_metadata</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">classic_event_metadata_by_id</span><span class="p">[</span><span class="n">providername</span><span class="p">]</span> <span class="o">=</span> <span class="n">events_metadata</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">classic_event_metadata_by_id</span><span class="p">[</span><span class="n">providername</span><span class="p">][</span><span class="nb">id</span><span class="p">]</span>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> &quot;</span><span class="si">{1}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="EvtFile">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtFile">[docs]</a>
<span class="k">class</span> <span class="nc">EvtFile</span><span class="p">(</span><span class="n">EvtChannel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent an Evtx file&quot;&quot;&quot;</span>
    <span class="n">DEFAULT_QUERY_FLAGS</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtQueryFilePath</span> <span class="o">+</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtQueryForwardDirection</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Not implemented for EvtFile</span>

<span class="sd">        :raise: :class:`NotImplementedError`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Cannot retrieve the configuration of an EvtFile&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ChannelConfig">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.ChannelConfig">[docs]</a>
<span class="k">class</span> <span class="nc">ChannelConfig</span><span class="p">(</span><span class="n">EvtHandle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The configuration of a event channel&quot;&quot;&quot;</span>

    <span class="c1"># TODO: https://learn.microsoft.com/en-us/windows/win32/api/winevt/nf-winevt-evtsetchannelconfigproperty</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ChannelConfig</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<div class="viewcode-block" id="ChannelConfig.from_channel_name">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.ChannelConfig.from_channel_name">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_channel_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the :class:`ChannelConfig` for the channel ``name``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenChannelConfig</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">publisher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`EvtPublisher` for the channel&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">EvtPublisher</span><span class="p">(</span><span class="n">chaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtChannelConfigOwningPublisher</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="ChannelConfig.publishers">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.ChannelConfig.publishers">[docs]</a>
    <span class="k">def</span> <span class="nf">publishers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The list of Publisher publishing on the channel. seems pertinent for Legacy channel like &quot;System&quot;</span>

<span class="sd">        :type: [:class:`EvtPublisher`] - A list of :class:`EvtPublisher`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">EvtPublisher</span><span class="p">(</span><span class="n">pub</span><span class="p">)</span> <span class="k">for</span> <span class="n">pub</span> <span class="ow">in</span> <span class="n">chaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtChannelPublisherList</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">]</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keywords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">chaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtChannelPublishingConfigKeywords</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">chaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtChannelConfigEnabled</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;``True`` if the channel is a classic event channel (for example the Application or System log)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">chaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtChannelConfigClassicEventlog</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> &quot;</span><span class="si">{1}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>



<span class="k">class</span> <span class="nc">PublisherMetadataChannel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent a PublisherMetadataChannel (see https://docs.microsoft.com/en-us/windows/win32/api/winevt/ne-winevt-evt_publisher_metadata_property_id)&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pub_metadata</span><span class="p">,</span> <span class="n">channel_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PublisherMetadataChannel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span> <span class="o">=</span> <span class="n">pub_metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">channel_id</span>

    <span class="k">def</span> <span class="nf">_query_channel_metadata_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span><span class="o">.</span><span class="n">chanrefs</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">propertyid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The flags of the ``PublisherMetadataChannel``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_channel_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferenceFlags</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The name of the ``PublisherMetadataChannel``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_channel_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferencePath</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The reference id of the ``PublisherMetadataChannel``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_channel_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferenceID</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The reference index of the ``PublisherMetadataChannel``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_channel_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferenceIndex</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The message id of the ``PublisherMetadataChannel``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_channel_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferenceMessageID</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">PublisherMetadataLevel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent a PublisherMetadataLevel (see https://docs.microsoft.com/en-us/windows/win32/api/winevt/ne-winevt-evt_publisher_metadata_property_id)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pub_metadata</span><span class="p">,</span> <span class="n">channel_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PublisherMetadataLevel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span> <span class="o">=</span> <span class="n">pub_metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">channel_id</span>

    <span class="k">def</span> <span class="nf">_query_level_metadata_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span><span class="o">.</span><span class="n">levelrefs</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">propertyid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_level_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataLevelName</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_level_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataLevelValue</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_level_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataLevelMessageID</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">PublisherMetadataOpcode</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent a PublisherMetadataOpcode (see https://docs.microsoft.com/en-us/windows/win32/api/winevt/ne-winevt-evt_publisher_metadata_property_id)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pub_metadata</span><span class="p">,</span> <span class="n">channel_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PublisherMetadataOpcode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span> <span class="o">=</span> <span class="n">pub_metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">channel_id</span>

    <span class="k">def</span> <span class="nf">_query_opcode_metadata_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span><span class="o">.</span><span class="n">opcoderefs</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">propertyid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The name of the ``PublisherMetadataOpcode``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_opcode_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataOpcodeName</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The opcode value of the ``PublisherMetadataOpcode``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_opcode_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataOpcodeValue</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The message id of the ``PublisherMetadataOpcode``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_opcode_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataOpcodeMessageID</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">PublisherMetadataKeyword</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent a PublisherMetadataKeyword (see https://docs.microsoft.com/en-us/windows/win32/api/winevt/ne-winevt-evt_publisher_metadata_property_id)&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pub_metadata</span><span class="p">,</span> <span class="n">channel_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PublisherMetadataKeyword</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span> <span class="o">=</span> <span class="n">pub_metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">channel_id</span>

    <span class="k">def</span> <span class="nf">_query_keyword_metadata_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span><span class="o">.</span><span class="n">keywordrefs</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">propertyid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The name of the ``PublisherMetadataKeyword``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_keyword_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataKeywordName</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The value of the ``PublisherMetadataKeyword``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_keyword_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataKeywordValue</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The message id of the ``PublisherMetadataKeyword``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_keyword_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataKeywordMessageID</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">PublisherMetadataTask</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represent a PublisherMetadataTask (see https://docs.microsoft.com/en-us/windows/win32/api/winevt/ne-winevt-evt_publisher_metadata_property_id)&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pub_metadata</span><span class="p">,</span> <span class="n">channel_id</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PublisherMetadataTask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span> <span class="o">=</span> <span class="n">pub_metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">channel_id</span>

    <span class="k">def</span> <span class="nf">_query_keyword_metadata_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_metadata</span><span class="o">.</span><span class="n">taskrefs</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">propertyid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The name of the ``PublisherMetadataTask``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_keyword_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataTaskName</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The value of the ``PublisherMetadataTask``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_keyword_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataTaskValue</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">event_guid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The event GUId of the ``PublisherMetadataTask``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_keyword_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataTaskEventGuid</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The message ID GUId of the ``PublisherMetadataTask``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_query_keyword_metadata_property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataTaskMessageID</span><span class="p">))</span>

<div class="viewcode-block" id="EvtPublisher">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtPublisher">[docs]</a>
<span class="k">class</span> <span class="nc">EvtPublisher</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An Event provider&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the metadata for this publisher</span>

<span class="sd">        :type: :class:`PublisherMetadata`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PublisherMetadata</span><span class="o">.</span><span class="n">from_publisher_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> &quot;</span><span class="si">{1}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="PublisherMetadata">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.PublisherMetadata">[docs]</a>
<span class="k">class</span> <span class="nc">PublisherMetadata</span><span class="p">(</span><span class="n">EvtHandle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The metadata about an event provider&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PublisherMetadata</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<div class="viewcode-block" id="PublisherMetadata.from_publisher_name">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.PublisherMetadata.from_publisher_name">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_publisher_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`PublisherMetadata` for the publisher ``name``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenPublisherMetadata</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">guid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The GUID associated with this provider</span>

<span class="sd">        :type:  [:class:`GUID`] -- the GUID in a XXXXXXXXXX-YYYY-ZZZZ-TTTT-VVVVVVVVVV form</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataPublisherGuid</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chanrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identifies the channels child element of the provider.</span>

<span class="sd">        :type: :class:`PropertyArray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PropertyArray</span><span class="p">(</span><span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferences</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">levelrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identifies the levels child element of the provider.</span>

<span class="sd">        :type: :class:`PropertyArray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PropertyArray</span><span class="p">(</span><span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataLevels</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">opcoderefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identifies the opcodes child element of the provider.</span>

<span class="sd">        :type: :class:`PropertyArray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PropertyArray</span><span class="p">(</span><span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataOpcodes</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keywordrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The list of keywords defined by this provider</span>

<span class="sd">        :type: :class:`PropertyArray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PropertyArray</span><span class="p">(</span><span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataKeywords</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">taskrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The list of tasks defined by this provider</span>

<span class="sd">        :type: :class:`PropertyArray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PropertyArray</span><span class="p">(</span><span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataTasks</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channels_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`PublisherMetadataChannel` for each channel this provider defines</span>

<span class="sd">        :yield: :class:`PublisherMetadataChannel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">PublisherMetadataChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chanrefs</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">levels_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`PublisherMetadataLevel` for each level this provider defines</span>

<span class="sd">        :yield: :class:`PublisherMetadataLevel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">PublisherMetadataLevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levelrefs</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">opcodes_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`PublisherMetadataOpcode` for each opcode this provider defines</span>

<span class="sd">        :yield: :class:`PublisherMetadataOpcode`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">PublisherMetadataOpcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opcoderefs</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tasks_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`PublisherMetadataTask` for each opcode this provider defines</span>

<span class="sd">        :yield: :class:`PublisherMetadataTask`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">PublisherMetadataTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taskrefs</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keywords_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`PublisherMetadataKeyword` for each opcode this provider defines</span>

<span class="sd">        :yield: :class:`PublisherMetadataKeyword`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">PublisherMetadataKeyword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keywordrefs</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">events_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The :class:`EventMetadata` for each event this provider defines</span>

<span class="sd">        :yield: :class:`EventMetadata`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenEventMetadataEnum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">ClosingEvtHandle</span><span class="p">(</span><span class="n">eh</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">nh</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtNextEventMetadata</span><span class="p">(</span><span class="n">eh</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">EventMetadata</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_NO_MORE_ITEMS</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">break</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channel_name_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The dict of channel defined by this provider by their id</span>

<span class="sd">        :type: :class:`dict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chansref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chanrefs</span>
        <span class="n">channame_by_value_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chansref</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">chansref</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferenceID</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">chansref</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferencePath</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">channame_by_value_id</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">channame_by_value_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The list of :class:`EvtChannel` defined by this provider</span>

<span class="sd">        :type: [:class:`EvtChannel`] -- A list of :class:`EvtChannel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chansref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chanrefs</span>
        <span class="n">propertyid</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferencePath</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">EvtChannel</span><span class="p">(</span><span class="n">chansref</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">propertyid</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chansref</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

<div class="viewcode-block" id="PublisherMetadata.message">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.PublisherMetadata.message">[docs]</a>
    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgid</span><span class="p">):</span>
        <span class="s2">&quot;TODO&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">sbuff</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">LPWSTR</span><span class="p">)</span>
        <span class="n">outsize</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">winproxy</span><span class="o">.</span><span class="n">EvtFormatMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">msgid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtFormatMessageId</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">sbuff</span><span class="p">,</span> <span class="n">outsize</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_EVT_UNRESOLVED_VALUE_INSERT</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">return</span> <span class="n">sbuff</span><span class="o">.</span><span class="n">value</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataPublisherMessageID</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataMessageFilePath</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_resource_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataResourceFilePath</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_parameter_filepath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataParameterFilePath</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> &quot;</span><span class="si">{1}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="PropertyArray">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.PropertyArray">[docs]</a>
<span class="k">class</span> <span class="nc">PropertyArray</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_OBJECT_ARRAY_PROPERTY_HANDLE</span><span class="p">):</span>
    <span class="s2">&quot;TODO&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">array_size</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetObjectArraySize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">array_size</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">arrayproperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="EventMetadata">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EventMetadata">[docs]</a>
<span class="k">class</span> <span class="nc">EventMetadata</span><span class="p">(</span><span class="n">EvtHandle</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The Metadata about a given Event type</span>


<span class="sd">    see: https://msdn.microsoft.com/en-us/library/windows/desktop/aa385517(v=vs.85).aspx</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The ID of the Event&quot;&quot;&quot;</span>
        <span class="c1"># https://docs.microsoft.com/en-us/windows/desktop/wes/eventschema-systempropertiestype-complextype</span>
        <span class="c1"># Qualifiers:</span>
        <span class="c1"># A legacy provider uses a 32-bit number to identify its events.</span>
        <span class="c1"># If the event is logged by a legacy provider, the value of EventID</span>
        <span class="c1"># element contains the low-order 16 bits of the event identifier and the</span>
        <span class="c1"># Qualifier attribute contains the high-order 16 bits of the event identifier.</span>
        <span class="c1"># [Question] Only true for legacy provider / channels ??</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventID</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xffff</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The version of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventVersion</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channel_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The Channel attribute of the Event definition&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventChannel</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">keyword</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The keyword attribute of the Event definition&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventKeyword</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">opcode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The opcode attribute of the Event definition&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventOpcode</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The level attribute of the Event definition&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventLevel</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The task attribute of the Event definition&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventTask</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identifies the message attribute of the event definition.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventMessageID</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identifies the template attribute of the event definition which is an XML string&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventTemplate</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">_parse_event_template_data_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">}</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">&quot;inType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;inType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">&quot;outType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;outType&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">value</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">_parse_event_template_struct_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;struct&quot;</span><span class="p">}</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_event_template_data_element</span><span class="p">(</span><span class="n">elt</span><span class="p">)</span> <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">childNodes</span> <span class="k">if</span> <span class="n">elt</span><span class="o">.</span><span class="n">nodeType</span> <span class="o">==</span> <span class="n">elt</span><span class="o">.</span><span class="n">ELEMENT_NODE</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">_event_data_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
        <span class="n">xmldoc</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="n">xmltemplate</span> <span class="o">=</span> <span class="n">xmldoc</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;template&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">xmltemplate</span><span class="o">.</span><span class="n">childNodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">nodeType</span> <span class="o">==</span> <span class="n">n</span><span class="o">.</span><span class="n">ELEMENT_NODE</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">tagName</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_event_template_data_element</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">element</span><span class="o">.</span><span class="n">tagName</span> <span class="o">==</span> <span class="s2">&quot;struct&quot;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_event_template_struct_element</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected XML element &lt;</span><span class="si">{0}</span><span class="s2">&gt; in event template&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">tagName</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">event_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The list of attribute specifique for this event.</span>
<span class="sd">        Retrieved by parsing :data:`EventMetadata.template`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">template</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_event_data_generator</span><span class="p">(</span><span class="n">template</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">yolo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">template</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">xmltemplate</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xmltemplate</span></div>



<div class="viewcode-block" id="EvtlogManager">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager">[docs]</a>
<span class="k">class</span> <span class="nc">EvtlogManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The main Evt class to open Evt channel/publisher and evtx file&quot;&quot;&quot;</span>
    <span class="c1"># https://msdn.microsoft.com/en-us/library/windows/desktop/aa385784(v=vs.85).aspx</span>

<div class="viewcode-block" id="EvtlogManager.is_implemented">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.is_implemented">[docs]</a>
    <span class="k">def</span> <span class="nf">is_implemented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return ``True`` if the new Evt-API is implemented on the current computer</span>

<span class="sd">        see: https://msdn.microsoft.com/en-us/library/windows/desktop/aa385784(v=vs.85).aspx</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">is_implemented</span><span class="p">(</span><span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtQuery</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenChannelEnum</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ressize</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">ClosingEvtHandle</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtNextChannelPath</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">ressize</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_NO_MORE_ITEMS</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">return</span>
                <span class="k">assert</span> <span class="n">buffer</span><span class="p">[</span><span class="n">ressize</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[:</span><span class="n">ressize</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">chan</span> <span class="o">=</span> <span class="n">EvtChannel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">chan</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">publishers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenPublisherEnum</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ressize</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">ClosingEvtHandle</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtNextPublisherId</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">ressize</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_NO_MORE_ITEMS</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">return</span>
                <span class="k">assert</span> <span class="n">buffer</span><span class="p">[</span><span class="n">ressize</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[:</span><span class="n">ressize</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">publisher</span> <span class="o">=</span> <span class="n">EvtPublisher</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">publisher</span>



<div class="viewcode-block" id="EvtlogManager.open_channel">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.open_channel">[docs]</a>
    <span class="k">def</span> <span class="nf">open_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the Evt channel with ``name``</span>

<span class="sd">        :rtype: :class:`EvtChannel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chan</span> <span class="o">=</span> <span class="n">EvtChannel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">chan</span><span class="o">.</span><span class="n">config</span> <span class="c1"># Force to retrieve a handle (check channel exists)</span>
        <span class="k">return</span> <span class="n">chan</span></div>


<div class="viewcode-block" id="EvtlogManager.open_evtx_file">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.open_evtx_file">[docs]</a>
    <span class="k">def</span> <span class="nf">open_evtx_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the evtx file with ``filename``</span>

<span class="sd">        :rtype: :class:`EvtFile`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">windows</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">DisableWow64FsRedirection</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">WindowsError</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_FILE_NOT_FOUND</span><span class="p">,</span> <span class="s2">&quot;Could not find file &lt;</span><span class="si">{0}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">EvtFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file</span></div>


<div class="viewcode-block" id="EvtlogManager.open_publisher">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.open_publisher">[docs]</a>
    <span class="k">def</span> <span class="nf">open_publisher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the Evt publisher with ``name``</span>

<span class="sd">        :rtype: :class:`EvtPublisher`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">publisher</span> <span class="o">=</span> <span class="n">EvtPublisher</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">publisher</span><span class="o">.</span><span class="n">metadata</span> <span class="c1"># Force to retrieve a handle (check channel exists)</span>
        <span class="k">return</span> <span class="n">publisher</span></div>


<div class="viewcode-block" id="EvtlogManager.__getitem__">
<a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.__getitem__">[docs]</a>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open the Evt Channel/Publisher or Evtx file with ``name``</span>

<span class="sd">        :rtype: :class:`EvtChannel` or :class:`EvtPublisher` or :class:`EvtFile`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">==</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_ACCESS_DENIED</span><span class="p">:</span>
                <span class="k">raise</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_publisher</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">==</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_ACCESS_DENIED</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="c1"># Raise FILE_NOT_FOUND if not found (last chance)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_evtx_file</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>
</div>


</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">PythonForWindows 1.0.3 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">windows.winobject.event_log</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2015-2020, Clement Rouault.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>